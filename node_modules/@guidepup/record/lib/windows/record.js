"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.record = record;
const fs_1 = require("fs");
const path_1 = require("path");
const child_process_1 = require("child_process");
// eslint-disable-next-line @typescript-eslint/no-var-requires
const ffmpegPath = require("ffmpeg-static");
/**
 * [API Reference](https://www.guidepup.dev/docs/api/class-windows-record)
 *
 * Start a screen recording on Windows.
 *
 * ```ts
 * import { windowsRecord } from "@guidepup/record";
 *
 * (async () => {
 *   // Start the screen recording.
 *   const stopRecording = windowsRecord("./recordings/screenRecording.mp4");
 *
 *   // ... perform some commands.
 *
 *   // Stop the screen recording.
 *   stopRecording();
 * })();
 * ```
 *
 * @param {string} filepath The file path to save the screen recording to.
 * @returns {Function} A function to stop the screen recording.
 */
function record(filepath) {
    (0, fs_1.mkdirSync)((0, path_1.dirname)(filepath), { recursive: true });
    try {
        (0, fs_1.unlinkSync)(filepath);
    }
    catch {
        // file doesn't exist.
    }
    const screencapture = (0, child_process_1.spawn)(ffmpegPath, [
        "-f",
        "gdigrab",
        "-framerate",
        "60",
        "-i",
        "desktop",
        "-pix_fmt",
        "yuv420p",
        "-vcodec",
        "mpeg4",
        filepath,
    ]);
    return () => {
        screencapture.stdin.write("q");
    };
}
